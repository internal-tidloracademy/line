<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async function () {
      try {
        await liff.init({ liffId: "2007302184-J1LRyjwM" }); // üîÅ ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        document.getElementById('userId').value = profile.userId;
        console.log("‚úÖ userId loaded:", profile.userId);

      } catch (err) {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î LIFF: " + err.message);
        console.error("LIFF init error:", err);
      }
    });

    function handleSubmit(e) {
      e.preventDefault();

      const data = {
        userId: document.getElementById('userId').value,
        codeId: document.getElementById('codeId').value.trim(),
        nameEn: document.getElementById('nameEn').value.trim()
      };

      google.script.run
        .withSuccessHandler(res => {
          alert(res.message);
          document.getElementById('codeId').value = "";
          document.getElementById('nameEn').value = "";
        })
        .withFailureHandler(err => {
          alert("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err.message);
        })
        .submitFormData(data);

      // if (!data.userId) {
      //   alert("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö userId! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
      //   return;
      // }

    }
  </script>
</head>

<body>
  <h3>‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤</h3>
  <form onsubmit="handleSubmit(event)">
    <input type="hidden" id="userId">

    <label for="codeId">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</label><br>
    <input type="text" id="codeId" required><br>

    <label for="nameEn">‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©:</label><br>
    <input type="text" id="nameEn" required><br><br>

    <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </form>
</body>
</html>
