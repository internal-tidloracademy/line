<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Line Tidlor Academy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" 
          integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>
<body>
  <script>
    fetch('data.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }
        return response.json();
      })
      .then(data => {
        document.getElementById('output').innerText =
          `${data.title} (v${data.version})\n${data.message}`;
      })
      .catch(error => {
        document.getElementById('output').innerText = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message;
      });
    </script>
    <main class="d-flex align-items-center h-100">
        <div class="container">
            <div class="row">
                <div class="col-12">
                   <h1 class="text-center fw-bold">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Line OA<br>Tidlor Academy</h1>
                    <form id="stripe-login" method="post" name="myForm">
                      <!--onsubmit="send(event)"-->
                        <div class="form-group">
                            <label for="codeId">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label> <div id="codeIdHelp" class="d-inline text-danger form-text">*‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô CF ‡πÄ‡∏õ‡πá‡∏ô 10*</div>
                            <input type="text" class="form-control" aria-describedby="codeIdHelp" id="codeId" name="codeId" maxlength="8" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£">
              
                        </div>
                        <div class="form-group mt-3">
                            <label for="nameEn">‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</label>
                            <input type="text" class="form-control" id="nameEn" name="nameEn" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô">
                        </div>   
                        <div class="text-center">
                            <input type="submit" id="btn" value="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" class="btn w-100 mt-4">     
                            <p id="loading-text" style="display: none; margin-top: 10px;">‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</p>
                        </div>
                    </form>
                   <div id="success-message" style="display: none; text-align: center; margin-top: 20px;">
                      <h4>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h4>
                      <img src="https://cdn.glitch.global/b21d7bff-940d-45a2-a262-9d0a9dfc4a35/thank.png?v=1745491052245" class="img-fluid">
                      <p class="mb-0">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞</p>
                     
                   </div>
                </div>
            </div>
        </div>
    </main>
  
    <!-- script liff sdk -->    
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
<script>
  const liffId = '2007302184-J1LRyjwM'; // üîÅ ‡πÉ‡∏™‡πà LIFF ID ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å LINE Developers
  const scriptURL = 'https://script.google.com/macros/s/AKfycbxBlkjjj7yBlSUkJk43qyJ4b7rkSj1Jmoq0vsshBi-55YZqTzt9mF2-6fBvG6E4L0wFCQ/exec'; // üîÅ URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å GAS ‡∏ó‡∏µ‡πà deploy ‡πÄ‡∏õ‡πá‡∏ô Web App

  let userId = '';
  let isSubmitBound = false;

  window.addEventListener('DOMContentLoaded', () => {
    main();
  });

  function main() {
    liff.init({ liffId: liffId })
      .then(() => {
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        return liff.getProfile();
      })
      .then((profile) => {
        if (!profile) return;
        userId = profile.userId;
        console.log('‚úÖ ‡πÑ‡∏î‡πâ userId:', userId);

        // ‚úÖ ‡∏ú‡∏π‡∏Å form submit handler ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
        if (!isSubmitBound) {
          const form = document.forms['myForm'];
          const submitButton = document.getElementById('btn');
          const loadingText = document.getElementById('loading-text');
          const successMessage = document.getElementById('success-message');

          form.addEventListener('submit', (e) => {
            e.preventDefault();

            submitButton.style.display = 'none';
            loadingText.style.display = 'block';

            const codeId = form.querySelector('#codeId')?.value.trim();
            const nameEn = form.querySelector('#nameEn')?.value.trim();

            if (!userId || !codeId || !nameEn) {
              alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á");
              submitButton.style.display = 'inline-block';
              loadingText.style.display = 'none';
              return;
            }

            const formData = new FormData(form);
            formData.append('userId', userId);

            fetch(scriptURL, {
              method: 'POST',
              body: formData
            })
            .then(response => {
              console.log('‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', response);
              form.style.display = 'none';
              loadingText.style.display = 'none';
              successMessage.style.display = 'block';
            })
            .catch(error => {
              console.error('‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', error);
              alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
              submitButton.style.display = 'inline-block';
              loadingText.style.display = 'none';
            });
          });

          isSubmitBound = true;
        }
      })
      .catch(err => {
        console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ init LIFF:', err);
      });
  }
</script>

    <script src="script.js"></script>
</body>
</html>
